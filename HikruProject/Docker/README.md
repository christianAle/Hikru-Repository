# üê≥ Hikru Assessment Management API - Docker Setup

This directory contains the complete Docker implementation for the Hikru Assessment Management API, including both the Oracle database and the .NET 8 API application.

## üìÅ Directory Structure

```
Docker/
‚îú‚îÄ‚îÄ README.md                          # This file
‚îú‚îÄ‚îÄ deploy.ps1                         # PowerShell deployment script
‚îú‚îÄ‚îÄ docker-compose.yml                 # Complete application stack
‚îú‚îÄ‚îÄ Dockerfile                         # API application Docker image
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml            # Database-only setup
‚îÇ   ‚îî‚îÄ‚îÄ init-scripts/
‚îÇ       ‚îú‚îÄ‚îÄ 01-init-database.sql      # Database initialization
‚îÇ       ‚îî‚îÄ‚îÄ healthcheck.sql           # Health check script
```

## üöÄ Quick Start

### Prerequisites

1. **Docker Desktop** installed and running
2. **PowerShell 5.1+** (Windows) or **PowerShell Core 7+** (Cross-platform)
3. **Oracle Container Registry Account** (free)

### One-Command Deployment

```powershell
# Navigate to the Docker directory
cd Docker

# Start the complete application stack
.\deploy.ps1 -Action start
```

## üîß Setup Instructions

### 1. Oracle Container Registry Setup (One-time)

Before running the application, you need to accept Oracle's license:

1. **Visit Oracle Container Registry:**
   - Go to: https://container-registry.oracle.com/
   - Sign in with your Oracle account (create one if needed)

2. **Accept License Agreement:**
   - Navigate to "Database" ‚Üí "express"
   - Click on the Oracle Database Express Edition image
   - Accept the license agreement

3. **Login to Registry:**
   ```powershell
   docker login container-registry.oracle.com
   ```
   Enter your Oracle credentials when prompted.

### 2. Deploy the Application

```powershell
# Start everything (builds images if needed)
.\deploy.ps1 -Action start
```

The script will:
- ‚úÖ Check Docker status
- ‚úÖ Verify Oracle registry access
- üî® Build the API Docker image
- üóÑÔ∏è Start Oracle Database container
- üöÄ Start API application container
- ‚è≥ Wait for all services to be healthy
- üìä Display access URLs

## üéØ Available Commands

### PowerShell Deployment Script

```powershell
# Build all images
.\deploy.ps1 -Action build

# Start all services
.\deploy.ps1 -Action start

# Stop all services
.\deploy.ps1 -Action stop

# Restart all services
.\deploy.ps1 -Action restart

# View live logs
.\deploy.ps1 -Action logs

# Check service status
.\deploy.ps1 -Action status

# Clean up everything (removes all containers/images/volumes)
.\deploy.ps1 -Action clean

# Show help
.\deploy.ps1 -Action help
```

### Manual Docker Compose Commands

```powershell
# Start services
docker-compose up -d

# Stop services
docker-compose down

# View logs
docker-compose logs -f

# Check status
docker-compose ps

# Rebuild and start
docker-compose up -d --build
```

## üåê Access Points

Once deployed, the application will be available at:

| Service | URL | Description |
|---------|-----|-------------|
| **API Swagger UI** | http://localhost:8080/swagger | Interactive API documentation |
| **API Health Check** | http://localhost:8080/health | Application health status |
| **Oracle Enterprise Manager** | https://localhost:5500/em | Database management interface |
| **Direct API Access** | http://localhost:8080/api/assessments | REST API endpoints |

### Authentication

- **API Key**: `hikru-api-key-2025`
- **Usage**: Add header `X-API-Key: hikru-api-key-2025` or `Authorization: Bearer hikru-api-key-2025`

## üìä Service Configuration

### Oracle Database Container

- **Image**: `container-registry.oracle.com/database/express:21.3.0-xe`
- **Container Name**: `hikru-oracle-db`
- **Ports**: 
  - `1521:1521` (Database)
  - `5500:5500` (Enterprise Manager)
- **Credentials**:
  - **SYS Password**: `HikruPassword123`
  - **App User**: `hikru_user`
  - **App Password**: `HikruUser123`

### API Application Container

- **Image**: Built from `Dockerfile`
- **Container Name**: `hikru-assessment-api`
- **Port**: `8080:8080`
- **Environment**: Production
- **Health Check**: Enabled with `/health` endpoint

## üóÑÔ∏è Database Schema

The Oracle database is automatically initialized with:

### ASSESSMENTS Table
```sql
CREATE TABLE ASSESSMENTS (
    ID NUMBER(10) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TITLE VARCHAR2(100) NOT NULL,
    DESCRIPTION VARCHAR2(1000) NOT NULL,
    LOCATION VARCHAR2(200) NOT NULL,
    STATUS NUMBER(1) DEFAULT 0 NOT NULL,
    RECRUITER_ID NUMBER(10) NOT NULL,
    DEPARTMENT_ID NUMBER(10) NOT NULL,
    BUDGET NUMBER(18,2) NOT NULL,
    CLOSING_DATE DATE,
    CREATED_DATE DATE DEFAULT SYSDATE NOT NULL,
    UPDATED_DATE DATE DEFAULT SYSDATE NOT NULL
);
```

### Sample Data
5 sample assessment records are automatically inserted for testing.

## üîç Monitoring & Health Checks

### Application Health
```powershell
# Check API health
curl http://localhost:8080/health

# Check database connectivity
.\deploy.ps1 -Action status
```

### Logs
```powershell
# View all logs
.\deploy.ps1 -Action logs

# View specific service logs
docker-compose logs hikru-assessment-api
docker-compose logs hikru-oracle-db
```

### Container Status
```powershell
# PowerShell script status
.\deploy.ps1 -Action status

# Docker compose status
docker-compose ps

# Detailed container inspection
docker inspect hikru-assessment-api
docker inspect hikru-oracle-db
```

## üß™ Testing the API

### Using Swagger UI
1. Navigate to http://localhost:8080/swagger
2. Click "Authorize" and enter API key: `hikru-api-key-2025`
3. Test any endpoint directly from the browser

### Using PowerShell
```powershell
# Get API key information
Invoke-RestMethod -Uri "http://localhost:8080/api/auth/api-key"

# Get all assessments
$headers = @{ "X-API-Key" = "hikru-api-key-2025" }
Invoke-RestMethod -Uri "http://localhost:8080/api/assessments" -Headers $headers

# Create new assessment
$body = @{
    title = "Test Assessment"
    description = "Test description"
    location = "Remote"
    status = 1
    recruiterId = 999
    departmentId = 1
    budget = 50000.00
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8080/api/assessments" -Method POST -Body $body -ContentType "application/json" -Headers $headers
```

### Using cURL
```bash
# Get assessments
curl -H "X-API-Key: hikru-api-key-2025" http://localhost:8080/api/assessments

# Create assessment
curl -X POST http://localhost:8080/api/assessments \
  -H "X-API-Key: hikru-api-key-2025" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Test Assessment",
    "description": "Test description", 
    "location": "Remote",
    "status": 1,
    "recruiterId": 999,
    "departmentId": 1,
    "budget": 50000.00
  }'
```

## üõ†Ô∏è Troubleshooting

### Common Issues

#### üî¥ Oracle Registry Login Failed
```
‚ùå Oracle Container Registry access failed.
```
**Solution**: 
1. Visit https://container-registry.oracle.com/
2. Accept the license agreement for Oracle Database Express
3. Run: `docker login container-registry.oracle.com`

#### üî¥ Port Already in Use
```
Error: Port 8080 is already allocated
```
**Solution**: 
1. Stop conflicting services: `.\deploy.ps1 -Action stop`
2. Or change ports in `docker-compose.yml`

#### üî¥ Database Not Ready
```
Database: starting, API: unhealthy
```
**Solution**: 
- Wait longer (Oracle DB takes 2-5 minutes to initialize)
- Check logs: `.\deploy.ps1 -Action logs`

#### üî¥ API Health Check Failed
```
API: unhealthy
```
**Solution**:
1. Check API logs: `docker-compose logs hikru-assessment-api`
2. Verify database connectivity
3. Restart services: `.\deploy.ps1 -Action restart`

### Performance Issues

#### üü° Slow Database Startup
- **Cause**: Insufficient memory allocated to Docker
- **Solution**: Increase Docker Desktop memory to at least 4GB

#### üü° API Slow Response
- **Cause**: Database still initializing
- **Solution**: Wait for database health check to pass

### Cleanup and Reset

#### Complete Reset
```powershell
# Remove everything and start fresh
.\deploy.ps1 -Action clean
.\deploy.ps1 -Action start
```

#### Rebuild API Only
```powershell
# Stop services
docker-compose down

# Rebuild API image
docker-compose build hikru-api --no-cache

# Start services
docker-compose up -d
```

## üîí Security Considerations

### Development vs Production

‚ö†Ô∏è **Current setup is for DEVELOPMENT only**

For production deployment:

1. **Change Default Passwords**:
   - Oracle SYS password
   - Application database user password
   - JWT secret key
   - API key

2. **Use Environment Variables**:
   ```powershell
   # Set secure environment variables
   $env:ORACLE_PWD = "SecurePassword123!"
   $env:JWT_SECRET = "YourSecure256BitSecretKey"
   $env:API_KEY = "your-secure-api-key"
   ```

3. **Enable HTTPS**:
   - Configure SSL certificates
   - Update port mappings for HTTPS

4. **Network Security**:
   - Use custom Docker networks
   - Configure firewall rules
   - Enable Oracle security features

## üìö Additional Resources

### Oracle Database
- **Enterprise Manager**: https://localhost:5500/em
  - Username: `sys`
  - Password: `HikruPassword123`
  - Connect as: `SYSDBA`

### API Documentation
- **OpenAPI Spec**: http://localhost:8080/swagger/v1/swagger.json
- **Health Endpoint**: http://localhost:8080/health

### Docker Management
```powershell
# View all Hikru containers
docker ps --filter "name=hikru"

# View Docker networks
docker network ls

# View Docker volumes
docker volume ls

# Clean up unused Docker resources
docker system prune -f
```

## üÜò Support

If you encounter issues:

1. **Check logs**: `.\deploy.ps1 -Action logs`
2. **Verify status**: `.\deploy.ps1 -Action status`
3. **Try restart**: `.\deploy.ps1 -Action restart`
4. **Clean reset**: `.\deploy.ps1 -Action clean` then `.\deploy.ps1 -Action start`

For detailed troubleshooting, enable verbose Docker logging:
```powershell
$env:DOCKER_BUILDKIT = "0"
docker-compose up --verbose
```
