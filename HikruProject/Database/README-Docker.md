# Docker Setup for Hikru Assessment Management API

This document explains how to set up and run the Oracle Database using Docker for the Hikru Assessment Management API.

## Prerequisites

- Docker Desktop installed and running
- At least 4GB of available RAM for the Oracle container
- Docker Hub account (to pull Oracle images)

## Oracle Container Registry Setup

Before running the Oracle container, you need to accept the Oracle license and login to the Oracle Container Registry:

1. **Accept Oracle License Agreement:**
   - Visit: https://container-registry.oracle.com/
   - Click on "Database" → "express"
   - Sign in with your Oracle account (create one if needed)
   - Accept the license agreement

2. **Login to Oracle Container Registry:**
   ```bash
   docker login container-registry.oracle.com
   ```
   Enter your Oracle account credentials when prompted.

## Starting the Database

1. **Navigate to the project root directory:**
   ```bash
   cd c:\Users\RicardoGamboaArroyo\source\repos\Hikru
   ```

2. **Start the Oracle Database container:**
   ```bash
   docker-compose up -d oracle-db
   ```

3. **Wait for the database to initialize (this may take 2-5 minutes):**
   ```bash
   docker-compose logs -f oracle-db
   ```
   Wait until you see "DATABASE IS READY TO USE!" in the logs.

4. **Check database health:**
   ```bash
   docker-compose ps
   ```
   The status should show "healthy" for the oracle-db service.

## Database Connection Details

- **Host:** localhost
- **Port:** 1521
- **Service Name:** XE
- **Username:** hikru_user
- **Password:** HikruUser123
- **Connection String:** `Data Source=localhost:1521/XE;User Id=hikru_user;Password=HikruUser123;`

## Database Schema

The initialization script automatically creates:

### ASSESSMENTS Table
```sql
CREATE TABLE ASSESSMENTS (
    ID NUMBER(10) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TITLE VARCHAR2(100) NOT NULL,
    DESCRIPTION VARCHAR2(1000) NOT NULL,
    LOCATION VARCHAR2(200) NOT NULL,
    STATUS NUMBER(1) DEFAULT 0 NOT NULL,
    RECRUITER_ID NUMBER(10) NOT NULL,
    DEPARTMENT_ID NUMBER(10) NOT NULL,
    BUDGET NUMBER(18,2) NOT NULL,
    CLOSING_DATE DATE,
    CREATED_DATE DATE DEFAULT SYSDATE NOT NULL,
    UPDATED_DATE DATE DEFAULT SYSDATE NOT NULL
);
```

### Sample Data
The script also inserts 5 sample assessment records for testing.

## Useful Commands

### Start all services:
```bash
docker-compose up -d
```

### Stop all services:
```bash
docker-compose down
```

### View logs:
```bash
docker-compose logs oracle-db
```

### Connect to the database using SQL*Plus (from within container):
```bash
docker exec -it hikru-oracle-db sqlplus hikru_user/HikruUser123@XE
```

### Reset the database (WARNING: This will delete all data):
```bash
docker-compose down -v
docker-compose up -d oracle-db
```

## Running the API

After the database is running and healthy:

1. **Navigate to the API project directory:**
   ```bash
   cd Hikru
   ```

2. **Run the API:**
   ```bash
   dotnet run
   ```

3. **Access the API:**
   - Swagger UI: https://localhost:5001
   - API Base URL: https://localhost:5001/api

## Troubleshooting

### Container won't start:
- Ensure Docker Desktop is running
- Check if you're logged into Oracle Container Registry
- Verify you have accepted the Oracle license agreement

### Database connection issues:
- Wait for the container to be fully healthy (check with `docker-compose ps`)
- Verify the connection string matches the configuration
- Check if port 1521 is available on your system

### Performance issues:
- Increase Docker Desktop memory allocation to at least 4GB
- Close unnecessary applications to free up system resources

### Permission issues:
- Ensure Docker Desktop is running with appropriate permissions
- On Windows, make sure Docker Desktop has access to the drive where the project is located

## Oracle Enterprise Manager

You can also access Oracle Enterprise Manager at:
- URL: https://localhost:5500/em
- Username: sys
- Password: HikruPassword123
- Connect as: SYSDBA

## Data Persistence

The database data is persisted in a Docker volume named `oracle_data`. This means your data will survive container restarts unless you explicitly remove the volume with `docker-compose down -v`.

## Security Notes

⚠️ **Important:** The credentials used in this setup are for development purposes only. In production:

- Use strong, unique passwords
- Store credentials in environment variables or secure vaults
- Configure proper network security
- Enable Oracle security features like encryption and auditing
- Regularly update the Oracle image to get security patches
